CREATE OR REPLACE FUNCTION public.suma_procedimientos_sexo(mes integer, anho integer, areaid integer)
 RETURNS TABLE(femenino bigint, masculino bigint, suma numeric)
 LANGUAGE plpgsql
AS $function$
	BEGIN
		return query
		select
 o.femenino, o.masculino,
 SUM(o.femenino + o.masculino) AS suma
FROM(
	------------conteo procedimientos--------------------------
select count(per.sexo) as femenino,
(SELECT count(per.sexo)
	FROM procedimientos proc
	left join funcionarios f on proc.funcionario_id = f.funcionario_id 
	left join areas a on proc.area_id = a.area_id 	
	left join pacientes p on proc.paciente_id = p.paciente_id
	left join personas per on p.persona_id=per.persona_id
	left join carreras cr on per.carrera_id=cr.carrera_id
	left join estamentos es on per.estamento_id = es.estamento_id
	WHERE  EXTRACT(MONTH FROM fecha)=mes and EXTRACT(YEAR FROM fecha)=anho 
	and per.sexo like '%M%' and (es.codigo='EST' or es.codigo='FUN' or es.codigo='DOC')
	and proc.area_id  = areaid
	 AND proc.estado like '%FINALIZADO%') as masculino
FROM procedimientos proc
left join funcionarios f on proc.funcionario_id = f.funcionario_id 
left join areas a on proc.area_id = a.area_id 
left join pacientes p on proc.paciente_id = p.paciente_id
left join personas per on p.persona_id=per.persona_id 
left join carreras cr on per.carrera_id=cr.carrera_id
left join estamentos es on per.estamento_id = es.estamento_id
WHERE 
EXTRACT(MONTH FROM fecha)=mes and EXTRACT(YEAR FROM fecha)=anho 
and per.sexo like '%F%' and (es.codigo='EST' or es.codigo='FUN' or es.codigo='DOC')
and proc.area_id  = areaid
AND proc.estado like '%FINALIZADO%'
	)AS o
	GROUP BY 
		 o.femenino, 
		 o.masculino;
	END;
$function$
;

